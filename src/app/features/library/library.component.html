<div class="library-container">
  <h1>My Library</h1>
  <app-upload></app-upload>
  
  @if (loading$ | async) {
    <p>Loading...</p>
  }
  
  <div class="library-grid">
    @for (doc of documents$ | async; track doc.id) {
      <div class="document-card">
        <div class="document-icon">
          {{ doc.type === 'epub' ? 'üìñ' : 'üìÑ' }}
        </div>
        <h3>{{ doc.title }}</h3>
        <p class="doc-type">{{ doc.type | uppercase }}</p>
        <p class="doc-size">{{ formatFileSize(doc.fileSize) }}</p>
        @if (doc.currentPage && doc.totalPages) {
          <div class="card-progress-bar" [attr.title]="getProgress(doc) + '% complete'">
            <div class="card-progress-fill" [style.width.%]="getProgress(doc)"></div>
          </div>
          <p class="doc-progress">
            Page {{ doc.currentPage }} / {{ doc.totalPages }} ¬∑ {{ getProgress(doc) }}%
          </p>
        }
        @if (doc.lastOpened) {
          <p class="doc-meta">
            Last opened: {{ formatDate(doc.lastOpened) }}
          </p>
        }
        <div class="card-badges">
          @if (doc.bookmarks && doc.bookmarks.length > 0) {
            <span class="badge bookmark-badge" title="Bookmarks">üîñ {{ doc.bookmarks.length }}</span>
          }
          @if (doc.readingStats && doc.readingStats.totalReadingTime > 0) {
            <span class="badge time-badge" title="Total reading time">‚è±Ô∏è {{ formatDuration(doc.readingStats.totalReadingTime) }}</span>
          }
          @if (doc.readingGoal && doc.readingGoal.currentStreak > 0) {
            <span class="badge streak-badge" title="Reading streak">üî• {{ doc.readingGoal.currentStreak }}d</span>
          }
        </div>
        <div class="card-actions">
          @if (doc.currentPage && doc.currentPage > 1) {
            <button (click)="openDocument(doc.id)" class="btn-resume">‚ñ∂ Resume</button>
          } @else {
            <button (click)="openDocument(doc.id)" class="btn-primary">Open</button>
          }
          <button (click)="deleteDocument(doc.id)" class="btn-danger">Delete</button>
        </div>
      </div>
    } @empty {
      <p class="empty-state">No documents yet. Upload one to get started!</p>
    }
  </div>
</div>
